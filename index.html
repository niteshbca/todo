<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Offline Safe Input</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  background:#f2f2f2;
}
.box{
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:280px;
}
input{
  width:100%;
  padding:10px;
  font-size:16px;
}
p{
  margin-top:10px;
}
.offline{color:red;}
.online{color:green;}
</style>
</head>

<body>
<div class="box">
  <h3>ðŸ”„ Smart Sync Input</h3>
  <input id="inputText" placeholder="Type freely...">
  <p id="status" class="online">Online</p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyCgLtg0zJCCx6OHUKII3yN4GCYIHjGJsKk",
  authDomain: "to-do-56239.firebaseapp.com",
  databaseURL: "https://to-do-56239-default-rtdb.firebaseio.com",
  projectId: "to-do-56239",
  storageBucket: "to-do-56239.appspot.com",
  messagingSenderId: "434619242688",
  appId: "1:434619242688:web:43c2151a4ef39a7052f525"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dataRef = ref(db, "shared/input");

/* ===== LOCAL STORAGE (OFFLINE FIRST) ===== */
let localValue = localStorage.getItem("localInput") || "";
inputText.value = localValue;

/* INPUT EVENT (NEVER BLOCKS) */
inputText.addEventListener("input", () => {
  localValue = inputText.value;
  localStorage.setItem("localInput", localValue);

  // Sirf online hone par Firebase bhejo
  if (navigator.onLine) {
    set(dataRef, localValue);
  }
});

/* FIREBASE â†’ INPUT (ONLINE SYNC) */
onValue(dataRef, snap => {
  if (!navigator.onLine) return; // offline me overwrite nahi
  if (snap.exists()) {
    inputText.value = snap.val();
    localStorage.setItem("localInput", snap.val());
  }
});

/* ONLINE / OFFLINE STATUS */
function updateStatus(){
  if(navigator.onLine){
    status.innerText = "Online âœ”";
    status.className = "online";
    // internet aate hi local â†’ firebase
    set(dataRef, localValue);
  }else{
    status.innerText = "Offline (Local mode)";
    status.className = "offline";
  }
}

window.addEventListener("online", updateStatus);
window.addEventListener("offline", updateStatus);
updateStatus();
</script>

</body>
</html>
