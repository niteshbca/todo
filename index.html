<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PWA Todo</title>

<link rel="manifest" href='data:application/json,{
  "name":"Todo PWA",
  "short_name":"Todo",
  "start_url":".",
  "display":"standalone",
  "theme_color":"#0d6efd",
  "background_color":"#ffffff"
}'>

<style>
body {
  font-family: Arial;
  background: #f1f3f6;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
.box {
  background: #fff;
  padding: 20px;
  width: 300px;
  border-radius: 10px;
}
input, button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
}
li {
  background: #eee;
  padding: 6px;
  margin-top: 6px;
  display: flex;
  justify-content: space-between;
}
</style>
</head>
<body>

<div class="box">
  <h3>üìù Todo PWA</h3>
  <input id="todo" placeholder="Enter task">
  <button onclick="addTodo()">Add</button>
  <ul id="list"></ul>
</div>

<script>
/* ===== TODO LOGIC (OFFLINE SAFE) ===== */
let todos = JSON.parse(localStorage.getItem("todos")) || [];

function draw() {
  list.innerHTML = "";
  todos.forEach((t, i) => {
    list.innerHTML += `<li>${t}<span onclick="del(${i})">‚ùå</span></li>`;
  });
  localStorage.setItem("todos", JSON.stringify(todos));
}

function addTodo() {
  let v = todo.value.trim();
  if (!v) return;
  todos.push(v);
  todo.value = "";
  draw();
}

function del(i) {
  todos.splice(i, 1);
  draw();
}

draw();

/* ===== SERVICE WORKER (PROPER OFFLINE CACHE) ===== */
if ('serviceWorker' in navigator) {

  const sw = `
    const CACHE = 'todo-v1';

    self.addEventListener('install', e => {
      e.waitUntil(
        caches.open(CACHE).then(c =>
          c.put('/', new Response(
            '<!DOCTYPE html>' + self.registration.scope
          ))
        )
      );
      self.skipWaiting();
    });

    self.addEventListener('activate', e => {
      self.clients.claim();
    });

    self.addEventListener('fetch', e => {
      e.respondWith(
        fetch(e.request).catch(() =>
          caches.match(e.request).then(r => r || caches.match('/'))
        )
      );
    });
  `;

  const blob = new Blob([sw], { type: 'text/javascript' });
  navigator.serviceWorker.register(URL.createObjectURL(blob));
}
</script>

</body>
</html>
